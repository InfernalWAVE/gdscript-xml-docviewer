<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GDScript XML Docviewer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        padding: 20px;
    }
    
    #title, .label {
        font-family: Arial, sans-serif; /* Changed to Arial to match the label */
        color: #333; /* A standard dark gray for better readability */
        text-align: center;
        font-size: 2em; /* Adjust the size to your preference */
        margin-top: 20px;
        margin-bottom: 20px;
    }
    
    .upload-area {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    .dynamic-iframe {
        border: 2px solid #000;
        width: 100%;
        margin-top: 20px;
        overflow: auto;
        display: block;
        min-height: 100px;
    }
    
    #output {
        padding: 10px;
        margin-top: 20px;
        border: 1px solid #ccc;
        min-height: 50px;
        position: relative;
    }
    
    #output-placeholder {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: #999;
    }
    
    .button-container button {
        padding: 10px 20px;
        font-size: 1em;
        margin-top: 10px;
        cursor: pointer;
        background-color: #005A9C;
        color: white;
        border: none;
        border-radius: 4px;
        transition: background-color 0.3s ease;
    }
    
    .button-container button:hover {
        background-color: #003D73;
    }
	
    .file-drop-area {
        border: 2px dotted #000; /* Dotted black border */
        border-radius: 10px;
        text-align: center;
        padding: 20px;
        color: #000; /* Black font color for better visibility */
        margin-bottom: 20px;
        transition: border-color 0.3s, color 0.3s;
        background-color: #fff; /* Optional: white background */
    }
    
    .file-drop-area.highlight {
        border-color: #3A8EE6;
        color: #3A8EE6;
    }
    
    .file-drop-area input {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
    }
    
    .file-drop-area label {
        display: block;
        cursor: pointer;
        margin-bottom: 10px; /* Add some space above the file list */
    }
    
    .file-list {
        margin-top: 10px;
        text-align: left;
        color: #000; /* Ensure the file list text is also black */
    }
</style>

</head>
<body>
    <h1 id="title">GDScript XML Docviewer</h1>
    
    <div id="xml-drop-area" class="file-drop-area">
        <input type="file" id="xmlFileInput" accept=".xml" multiple>
        <label for="xmlFileInput">Drag XML files here or click to upload</label>
        <div id="xml-file-list" class="file-list"></div>
    </div>
    
    <div id="xslt-drop-area" class="file-drop-area">
        <input type="file" id="xsltFileInput" accept=".xsl, .xslt">
        <label for="xsltFileInput">Drag XSLT file here or click to upload</label>
        <div id="xslt-file-list" class="file-list"></div>
    </div>

    <div class="button-container">
        <button onclick="processFiles()">Transform</button>
    </div>
    
    <div class="label">Documentation Viewer</div>
    <div id="output">
        <div id="output-placeholder">Transformed files will be shown here.</div>
    </div>

    <script>
        function setupDragAndDrop() {
            const dropAreas = document.querySelectorAll('.file-drop-area');

            dropAreas.forEach(area => {
                area.addEventListener('dragover', (event) => {
                    event.stopPropagation();
                    event.preventDefault();
                    event.dataTransfer.dropEffect = 'copy';
                    area.classList.add('highlight');
                });
                
                area.addEventListener('dragleave', (event) => {
                    area.classList.remove('highlight');
                });

                area.addEventListener('drop', (event) => {
                    event.stopPropagation();
                    event.preventDefault();
                    area.classList.remove('highlight');
                    const files = event.dataTransfer.files;
                    handleFiles(files, area);
                });

                area.addEventListener('click', () => {
                    area.querySelector('input').click();
                });

                area.querySelector('input').addEventListener('change', (event) => {
                    const files = event.target.files;
                    handleFiles(files, area);
                });
            });
        }

        function handleFiles(files, area) {
            let fileList = area.getElementsByClassName('file-list')[0];
            fileList.innerHTML = ''; // Clear the list
            
            Array.from(files).forEach(file => {
                let fileItem = document.createElement('div');
                fileItem.textContent = file.name;
                fileList.appendChild(fileItem);
            });
			if (area.id === 'xml-drop-area') {
                document.getElementById('xmlFileInput').files = files;
            } else if (area.id === 'xslt-drop-area') {
                document.getElementById('xsltFileInput').files = files;
            }
        }

        document.addEventListener('DOMContentLoaded', setupDragAndDrop);
		
		function processFiles() {
            const xmlFiles = document.getElementById('xmlFileInput').files;
            const xsltFile = document.getElementById('xsltFileInput').files[0];

            if (xmlFiles.length > 0 && xsltFile) {
                const xsltReader = new FileReader();
                xsltReader.onload = function(e) {
                    const xsltContent = e.target.result;
                    Array.from(xmlFiles).forEach(xmlFile => {
                        processFile(xmlFile, xsltContent);
                    });
                };
                xsltReader.readAsText(xsltFile);
            } else {
                alert("Please select XML files and an XSLT file.");
            }
        }

        function processFile(xmlFile, xsltContent) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const xmlContent = e.target.result;
                transformXML(xmlContent, xsltContent);
            };
            reader.readAsText(xmlFile);
        }

        function transformXML(xmlContent, xsltContent) {
            document.getElementById('output-placeholder').style.display = 'none';
			
			const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
            const xsltDoc = parser.parseFromString(xsltContent, 'text/xml');

            const xsltProcessor = new XSLTProcessor();
            xsltProcessor.importStylesheet(xsltDoc);

            const resultDocument = xsltProcessor.transformToDocument(xmlDoc);
            const iframe = document.createElement('iframe');
            iframe.className = 'dynamic-iframe';
            document.getElementById('output').appendChild(iframe);

            iframe.onload = function() {
                // Adjust the height of the iframe based on its content
                setTimeout(() => { // Timeout for content to render
                    const body = iframe.contentWindow.document.body;
                    const html = iframe.contentWindow.document.documentElement;
                    const height = Math.max(body.scrollHeight, body.offsetHeight,
                                           html.clientHeight, html.scrollHeight, html.offsetHeight);
                    iframe.style.height = height + 'px';
                    updateContainerHeight(); // Call to update the container height
                }, 0);
            };

            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write(new XMLSerializer().serializeToString(resultDocument));
            iframe.contentWindow.document.close();
        }

        function updateContainerHeight() {
            const outputDiv = document.getElementById('output');
            const iframes = outputDiv.getElementsByTagName('iframe');
            let newHeight = 0;
            for (let iframe of iframes) {
                newHeight += iframe.getBoundingClientRect().height;
            }
            // Account for any additional padding/margins
            newHeight += (iframes.length * 20); // Example: 20px margin for each iframe
            outputDiv.style.height = `${newHeight}px`;
        }
    </script>
</body>
</html>
